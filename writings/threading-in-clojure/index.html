<!DOCTYPE html>

<html><head><meta charset="utf-8" /><meta content="width=device-width, initial-scale=1.0" name="viewport" /><link href="/apple-touch-icon-57x57.png" rel="apple-touch-icon" sizes="57x57" /><link href="/apple-touch-icon-60x60.png" rel="apple-touch-icon" sizes="60x60" /><link href="/apple-touch-icon-72x72.png" rel="apple-touch-icon" sizes="72x72" /><link href="/apple-touch-icon-76x76.png" rel="apple-touch-icon" sizes="76x76" /><link href="/apple-touch-icon-114x114.png" rel="apple-touch-icon" sizes="114x114" /><link href="/apple-touch-icon-120x120.png" rel="apple-touch-icon" sizes="120x120" /><link href="/apple-touch-icon-144x144.png" rel="apple-touch-icon" sizes="144x144" /><link href="/apple-touch-icon-152x152.png" rel="apple-touch-icon" sizes="152x152" /><link href="/apple-touch-icon-180x180.png" rel="apple-touch-icon" sizes="180x180" /><link href="/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png" /><link href="/android-chrome-192x192.png" rel="icon" sizes="192x192" type="image/png" /><link href="/favicon-96x96.png" rel="icon" sizes="96x96" type="image/png" /><link href="/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png" /><link href="manifest.json" rel="manifest" /><link color="#5bbad5" href="/safari-pinned-tab.svg" rel="mask-icon" /><meta content="#da532c" name="msapplication-TileColor" /><meta content="/mstile-144x144.png" name="msapplication-TileImage" /><meta content="#ffffff" name="theme-color" /><link href="/bundles/28a3f0024957/all.min.css" rel="stylesheet" /><link href="https://fonts.googleapis.com/css?family=Lato:400,300,400italic,700,900" rel="stylesheet" type="text/css" /><link href="https://fonts.googleapis.com/css?family=Quicksand:400,700" rel="stylesheet" type="text/css" /><link href="https://fonts.googleapis.com/css?family=Josefin+Sans:400,700italic,700,600italic,600,400italic,300italic,300" rel="stylesheet" type="text/css" /><script src="/bundles/8181a25eaea5/all.min.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-22539794-3', 'auto');
              ga('send', 'pageview');</script><title>Peter M. Elias - Full Stack Developer</title></head><body><section class="l-header"><article class="header-mini"><article class="header-mini__content"><a href="/"></a><h6 class="header-mini__title">P<span class="header-mini__red">M</span>E</h6><h5 class="header-mini__current-page">writing</h5></article></article></section><section class="l-main" id="main"><section class="l-navigation"><article class="navlist" id="navlist"><article class="spin-button" id="navlist-expand"><span class="spin-button__icon"></span></article><ul class="navlist__list" id="navlist-list"><li class="navlist__item  "><a href="/portfolio">portfolio</a></li><li class="navlist__item  active"><a href="/writings">writings</a></li><li class="navlist__item  "><a href="/hire-me">hiring me</a></li><li class="navlist__item  "><a href="/about">about me</a></li><li class="navlist__item  "><a href="https://www.github.com/petermelias" target="_blank">github</a></li></ul></article></section><section class="l-page"><section class="writing"><h5>Understanding the Thread Macro in Clojure</h5><p>I am writing this post because while the concept of the thread macro in Clojure is very simple, the syntax seems to throw people off.</p><p>That said, you should be comfortable with LISP syntax to begin with or this <em>really</em> won't make sense.</p>
<pre><code class="codehilite"><span class="p">(</span><span class="nf">clojure.string/replace</span> <span class="s">"hello"</span> <span class="o">#</span><span class="s">"h"</span> <span class="s">"x"</span><span class="p">)</span>
</code></pre><p>That blindly simple line of code produces this output.</p>
<pre><code class="codehilite"><span class="s">"xello"</span>
</code></pre><p>Often I find I want to perform multiple transformations on a string... no problem!</p>
<pre><code class="codehilite"><span class="p">(</span><span class="nf">clojure.string/replace</span>
  <span class="p">(</span><span class="nf">clojure.string/replace</span> <span class="s">"hello"</span> <span class="o">#</span><span class="s">"h"</span> <span class="s">"x"</span><span class="p">)</span> <span class="o">#</span><span class="s">"^."</span> <span class="o">#</span><span class="p">(</span><span class="nf">clojure.string/upper-case</span> <span class="nv">%</span><span class="p">))</span>

<span class="s">"Xello"</span> <span class="c1">;;output</span>
</code></pre><p>What on earth is that abomination! Not the anonymous function literal, that's super cool and we'll cover that in another post.</p><p>The ugly part about this is the nested calls to <code>string/replace</code>, we don't need to be doing it quite like that.</p><p>We can use the <em>thread first macro</em>.</p>
<pre><code class="codehilite"><span class="p">(</span><span class="nb">-&gt; </span><span class="s">"hello"</span>
  <span class="p">(</span><span class="nf">clojure.string/replace</span> <span class="o">#</span><span class="s">"h"</span> <span class="s">"x"</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">clojure.string/replace</span> <span class="o">#</span><span class="s">"^."</span> <span class="o">#</span><span class="p">(</span><span class="nf">clojure.string/upper-case</span> <span class="nv">%</span><span class="p">)))</span>

<span class="s">"Xello"</span> <span class="c1">;; output</span>
</code></pre><p>As you can see that's a might bit clearer and hopefully illustrates how the thread <em>first</em> macro works.</p><p>Here is the simplest definition I can muster:</p>
<blockquote><p>The thead FIRST macro INSERTS the result of each form as the FIRST argument of the next form.</p>
</blockquote><p>The thread <em>last</em> macro does the opposite and inserts the results as the <em>LAST</em> argument of each form.</p>
<pre><code class="codehilite"><span class="p">(</span><span class="nf">-&gt;&gt;</span>
  <span class="p">(</span><span class="nb">range </span><span class="mi">5</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">map </span><span class="o">#</span><span class="p">(</span><span class="nb">* </span><span class="mi">2</span> <span class="nv">%</span><span class="p">)))</span>

<span class="p">(</span><span class="mi">0</span> <span class="mi">2</span> <span class="mi">4</span> <span class="mi">6</span> <span class="mi">8</span><span class="p">)</span> <span class="c1">;; output</span>
</code></pre><p>Simply passes <code>(range 5)</code> as the sequence to the <code>map</code> function. There's that sneaky anonymous function literal again, we'll write about that soon.</p></section></section></section><section class="l-footer"><footer><section class="footer-content"><p class="footer__text">copyright peter m elias 2003 - 2016</p></section></footer></section><button class="js-intercom-cta hidden"></button><script src="/javascript/intercom.js" type="text/javascript"></script></body></html>